var data = {};

(function() {

data.parties = [{name: "democrat", speeches: ["\nMARÍA TERESA FERNÁNDEZ DE LA VEGA SANZ:  Señoría, el Gobierno está trabajando firmemente comprometido en la recuperación económica y en la creación de empleo. Eso es trabajar por el bienestar de los españoles. Ustedes solo piensan en su bienestar y en las encuestas. (Aplausos.)\nMARÍA TERESA FERNÁNDEZ DE LA VEGA SANZ:  Tomar medidas para hacer frente a la crisis financiera es preocuparse por el bienestar de los españoles. Tomar medidas difíciles pero necesarias para apoyar los ajustes planteados por la Unión Europea es preocuparse por el bienestar de los españoles. Acometer reformas del mercado laboral es preocuparse por el bienestar de los españoles. Mientras el Gobierno se preocupa por el bienestar de los españoles y toma medidas, ¿qué hacen ustedes? Decir que no a todo, negarse a todo, erre que erre, desprestigia que algo quedará. (Protestas.) Utilizan todo como munición electoral contra el Gobierno, agazapados como furtivos. ¿Que los especuladores conspiran? Ustedes hacen de los rumores la estrategia electoral. Mientras el Gobierno está combatiendo informaciones falsas ustedes hacen una oposición quintacolumnista. Cada día se superan, van cada día a peor y su nivel de irresponsabilidad llega a ser tan grande que, mientras el presidente del Gobierno está defendiendo la solvencia de España, que a eso nos dedicamos frente a quienes están especulando y está adoptando medidas en Bruselas con otros países para hacer frente a la situación financiera, ustedes están de campañita, eso sí, hablando mal de España dentro y fuera. Pero como lo suyo es siempre el regate corto y la estrechez de miras, se han vuelto a quedar ustedes solos (Protestas.), porque el FMI, la OCDE, la Unión Europea, todos han apoyado nuestras reformas. (Un señor diputado: Fuera.)\nMARÍA TERESA FERNÁNDEZ DE LA VEGA SANZ:  Y todos las han apoyado en sentido positivo. Pero si hasta la señora Merkel se lo dejó bien clarito el otro día al señor Rajoy. Señoría, no sé quién está más solo aquí. Esa política del no a todo, esa política de no plantear nunca alternativa, esa política de la crítica total y absoluta les va a pasar factura, porque ¿quién va a confiar en una oposición que pretende gobernar que es incapaz de ayudar a su país cuando su país tiene problemas? Le aseguro que la mayoría no. (Protestas.) ¿Y sabe por qué? No solo porque les han calado, como ha dicho el presidente del Gobierno, es que se les ve el plumero; se lo dije el otro día, el plumero no, el plumerazo electoral. (Aplausos.-Protestas.)",
"\nELENA SALGADO MÉNDEZ:  Muchas gracias, señor presidente. Señoría, el caso Gürtel lo ha mencionado usted. En algo debería estar pensando. Por otra parte, el Gobierno no tiene en este tema nada más que respetar la autonomía y la independencia del Banco de España, y eso debería usted saberlo. (Aplausos.)\nELENA SALGADO MÉNDEZ:  Muchas gracias, señor presidente. Señoría, intenta usted ocultar su confusión institucional, pero no le va a servir porque se la voy a relatar. No entiendo por qué dirige esta pregunta al Gobierno, pretendiendo trasladarla de un ámbito parlamentario a otro. Señoría, hace unas semanas planteó usted esta cuestión en el marco de la Comisión Mixta para el Tribunal de Cuentas. En el día de ayer, sin atender a las razones que les aportaba un diputado presentó además unas propuestas de resolución que no se han aprobado, que SS.SS. han rechazado. Preguntado el gobernador del Banco de España en una comparecencia que no tenía nada que ver con la materia, su contestación es bastante clarificadora. Señoría, quiero decirle simplemente que yo no puedo dar ninguna instrucción ni ningún mandato a ningún partido político, ni al suyo ni al mío. De nuevo, insisten hoy con una pregunta dirigida al Gobierno que si tuvieran un mínimo de sensibilidad y de conocimiento, sabrían perfectamente que está fuera de lugar. (Aplausos.)\nELENA SALGADO MÉNDEZ:  Muchas gracias, señor presidente. Señoría, deberíamos ponernos de acuerdo en que la situación de crecimiento del crédito de familias y de empresas españolas no debe volver a ser la que era hace dos años. Esa ha sido, sin ninguna duda, una de las razones de la situación en la que estamos en este momento. Así pues, señoría, nos basta con que el crecimiento de crédito en el caso de las familias sea positivo. Además desde el inicio de la crisis financiera, el Gobierno, como usted sabe, está adoptando todo un conjunto de medidas para facilitar crédito a familias y a empresas. Lo ha hecho primero con las ayudas que ha prestado al sector financiero en forma de avales, en forma de compra de activos. Lo sigue haciendo a través del ICO, cuya actividad se ha potenciado muchísimo. Hace muy pocos días se ha puesto ya en marcha esa línea de crédito directo que se aprobó por este Congreso de los Diputados en la convalidación de un decreto-ley, y después se dieron instrucciones desde el Gobierno al Instituto de Crédito Oficial. Le puedo comunicar que hay ya más de 5.000 peticiones por más de 500 millones de euros; peticiones que serán estudiadas en muy breve plazo. Señoría, este Gobierno está haciendo todo lo posible para que el crédito llegue de una vez a empresas y a familias, y en esa tarea espero que la reordenación de las cajas de ahorro, en la que vamos a contar con su grupo, pueda ser de utilidad. Muchas gracias. (Aplausos.)\nELENA SALGADO MÉNDEZ:  Muchas gracias, señor presidente. Señoría, como sabe, la actuación del ICO durante el año pasado sirvió para que más de 300.000 empresas pudieran tener acceso al crédito, gracias precisamente a esos fondos que el ICO puso a su disposición. Lo mismo está haciendo este año. El relato que tenemos por parte del ICO de los primeros meses de este año muestra que esa actividad crediticia del ICO se ha incrementado en este año. Señorías, seguro que hace falta todavía hacer mucho más, pero hace falta algo muy evidente, que las propuestas que llegan al ICO, al igual que al resto de la banca, pero muy especialmente al ICO, que se financia, como sabe, a partir de créditos que consigue en el mercado pero que tienen la garantía del Estado, que esos créditos, que esas peticiones sean peticiones solventes. Seguramente tiene usted razón, en esta etapa de dificultad económica eso no siempre se produce. Desde luego, el ICO tiene que ser muy cuidadoso a la hora de conceder esos créditos. Más allá de ahí, señoría, estamos trabajando en un nuevo proyecto para la regulación de las cajas de ahorro; con posterioridad a su reestructuración, como siempre dijimos, la reestructuración termina el día 30 de junio, inmediatamente después no tenga ninguna duda de que podremos presentar un proyecto de ley para la... (Aplausos.)",
"\nMANUEL MARÍA CHAVES GONZÁLEZ:  Gracias, señor presidente. Señor diputado, como sabe, el Gobierno de España se comprometió con el Gobierno canario, a través del denominado Plan Canarias, que en la Unión Europea se pudieran contemplar y tuvieran un tratamiento diferenciado las peculiaridades y las singularidades de la comunidad canaria por su carácter ultraperiférico, así como el del resto de las regiones ultraperiféricas. Por eso, en las conclusiones que se han adoptado en el Consejo General de la Unión Europea celebrado recientemente, se ha tenido en cuenta el memorándum, como ha señalado, que se aprobó en la reunión de ministros y de representantes de las regiones ultraperiféricas que se celebró en Las Palmas de Gran Canaria durante el mes de abril, y después en el Foro de Regiones Ultraperiféricas de los días 27 y 28 de mayo. Por consiguiente, el objetivo que se había marcado la Presidencia española, de acuerdo con el Gobierno canario, de acuerdo con el presidente de la comunidad canaria ha sido un objetivo que se ha conseguido. Por tanto, hacemos una valoración positiva porque responde precisamente a los objetivos que con respecto a Canarias y las regiones ultraperiféricas nos habíamos fijado a lo largo de la Presidencia española. Es necesario considerar que, a partir de ahora, en el desarrollo de estas conclusiones, tendremos que estimar que las oportunidades y las necesidades de estas regiones ultraperiféricas y de las islas Canarias se tienen que tener en cuenta en la revisión de las políticas europeas, y por ende en la estrategia 2020, de tal modo que facilite ese tratamiento diferenciado en el marco financiero 2014 y 2020, y sigamos avanzando en el tratamiento diferenciado de estas regiones en la defensa de sus producciones tradicionales, por ejemplo, el plátano, en el tratamiento de las peculiaridades de su transporte, en definitiva también, en las necesidades hacia el área geográfica de su entorno. Ahora tenemos que colaborar en el desarrollo de estas conclusiones. El compromiso del Gobierno, en función del Plan Canarias, sigue en pie y, por supuesto, espero seguir contando con la colaboración del Gobierno canario, señor diputado. (Aplausos.)\nMANUEL MARÍA CHAVES GONZÁLEZ:  Señor presidente, señor Tamarí, (Risas.) en estos momentos el Gobierno no se plantea la disolución. (Rumores.)\nMANUEL MARÍA CHAVES GONZÁLEZ:  El Gobierno no se plantea la disolución del Ayuntamiento de El Ejido, y no se lo plantea porque considera que no concurren los supuestos establecidos en el artículo 61 de la Ley reguladora de bases del régimen local. No entendemos que existan o que se contemplen incumplimientos de las obligaciones constitucionales. (Aplausos.)\nMANUEL MARÍA CHAVES GONZÁLEZ:  Gracias, señor presidente. Señor Matarí, no me gusta la situación de El Ejido, pero nuestra obligación es cumplir la ley. Y la ley establece que para disolver un ayuntamiento tienen que darse unos supuestos que no se dan actualmente en El Ejido. Se lo dice precisamente un representante de un gobierno que ha sido el único, a lo largo de la democracia, que ha disuelto un ayuntamiento -el de Marbella-, algo que estuvo en manos del Partido Popular y no hizo cuando pudo hacerlo. (Varios señores diputados: ¡Muy bien!) La disolución no ofrece ninguna solución, porque seguirían teniendo mayoría absoluta en la comisión gestora quienes ahora gobiernan en El Ejido. Le voy a decir lo siguiente: ustedes practican como siempre la ley del embudo, señor Matarí. El señor Enciso estuvo en el Partido Popular durante catorce años, en los que ustedes dijeron que era el mejor alcalde de España y que estaba siendo triturado por la oposición del Partido Socialista. (Un señor diputado: ¡Qué barbaridad!) Eso es lo que ustedes dijeron. Ustedes eran uña y carne. Ustedes han compartido su ADN político con esa persona. Ustedes la alimentaron, ustedes la engrandecieron, y de aquellos polvos, señor Matarí, estos lodos. (Rumores.) Siguen con la ley del embudo, señor Matarí, y lo digo porque ustedes plantean la disolución del Ayuntamiento de El Ejido. ¿Por qué no plantean ustedes también la disolución del ayuntamiento de Alhaurín el Grande, donde el alcalde del Partido Popular ha estado procesado, arrestado e imputado? (Aplausos.-Rumores.) Lo mismo le puedo decir de Mogán, de Totana o de la Diputación de Castellón. Por tanto, para tener credibilidad ustedes tendrán que venir aquí a pedir la disolución de todos esos ayuntamientos."]}, {name: "republican", speeches: ["\nMARÍA SORAYA SÁENZ DE SANTAMARÍA ANTÓN: QUÉ HA APORTADO LA VICEPRESIDENTA PRIMERA DEL GOBIERNO AL BIENESTAR DE LOS ESPAÑOLES\nMARÍA SORAYA SÁENZ DE SANTAMARÍA ANTÓN:  Muchas gracias, señor presidente. Señoría, el Gobierno está más solo que nunca (Rumores.), no logra convencer...\nMARÍA SORAYA SÁENZ DE SANTAMARÍA ANTÓN:  Hoy empezamos más pronto.\nMARÍA SORAYA SÁENZ DE SANTAMARÍA ANTÓN:  Gracias, señor presidente. El Gobierno está más solo que nunca, no convence a ningún grupo parlamentario en esta Cámara. Por no convencer, no convence ni a los suyos propios. Su Gobierno es la imagen viva de la soledad parlamentaria y el aislamiento social, pero me interesa más analizar con usted por qué han llegado a esta situación. Primero, porque ya no tienen proyecto político y es muy difícil apoyar a quien no sabe lo que quiere; segundo, porque cómo van a pretender la colaboración de otros grupos si son incapaces de coordinarse entre ustedes mismos. Van a la búsqueda de un socio, pero la verdad, señoría, es que los miembros de este Gobierno actúan entre ellos más como rivales que como colegas. Usted es directamente la responsable de las relaciones con las Cortes. Aquí está sentada la oposición que más iniciativas parlamentarias ha presentado en la historia y ahí la vicepresidenta que más las ha vetado y que menos cumple los mandatos de este Parlamento. (Un señor diputado: ¡Muy bien!) Se produce una cosa muy curiosa. El Gobierno incumple los mandatos del Parlamento, pero quiere que el Parlamento asuma las obligaciones del Gobierno. Esa es la inversión de papeles del Gobierno de José Luis Rodríguez Zapatero. El principal problema de su Gobierno es que nadie confía en la palabra del presidente del Gobierno, pero tampoco en la suya propia, señora De la Vega. Usted les prometió a los funcionarios una subida de sus nóminas y ha acabado rebajándolas un 5 por ciento. Se comprometió en abril a mantener los puestos de trabajo de la Agencia EFE y resulta que los trabajadores de la agencia van a ser los primeros en experimentar los efectos de la reforma laboral, del despido que aprobaron ustedes solos, aunque no todos ustedes. Señoría, si ni los trabajadores, los emprendedores, los sindicatos, todos los grupos de esta Cámara ni algunos de los diputados de su grupo apoyan sus propuestas, ¿cómo piensa explicar a los españoles que trabaja para su bienestar? (Aplausos.)\nMARÍA SORAYA SÁENZ DE SANTAMARÍA ANTÓN:  Sí, señora vicepresidenta, con su respuesta me acaba de dar el otro argumento que me faltaba para ver por qué nadie confía en ustedes, porque usted no da a nadie explicaciones. Su única misión en esta Cámara es atacar a la oposición porque su Gobierno no tiene defensa posible. Solo les mueve el ánimo de supervivencia y no la vocación de servicio. Cuando los gobiernos no tienen soluciones se convierten en un problema para aquellos a los que gobiernan... (Aplausos.)",
"\nRAMÓN AGUIRRE RODRÍGUEZ: CÓMO VALORA LA VICEPRESIDENTA SEGUNDA Y MINISTRA DE ECONOMÍA Y HACIENDA QUE EL BANCO DE ESPAÑA NO FACILITE AL TRIBUNAL DE CUENTAS LA DOCUMENTACIÓN QUE SE LE REQUIERE SOBRE LA CONDONACIÓN DE LA DEUDA A DETERMINADO PARTIDO POLÍTICO\nRAMÓN AGUIRRE RODRÍGUEZ:  Gracias, señor presidente. Señora vicepresidenta, sospecho que en su respuesta va a utilizar el truco de mencionar el caso Gürtel. (Rumores.) Me gustaría, es lo que le reclamo, que cuando vaya a contestarme lo haga aludiendo al fondo de la cuestión. Ha quedado acreditado que en las cuentas del PSOE no estaban bien registradas las deudas bancarias, estaban incompletamente registradas. Ha quedado acreditado que en un año y de un plumazo desapareció la deuda bancaria de quince años atrás. Ha quedado acreditado que el Partido Socialista no ha enviado el acuerdo de eliminación de deuda bancaria al Tribunal de Cuentas, que la entidad financiera tampoco ha enviado ese acuerdo al Tribunal de Cuentas, y ha quedado acreditado que el Banco de España tampoco ha podido enviar el acuerdo de eliminación de deuda al que hago mención. Por esta razón y con esta aspiración le hago la pregunta que está formulada: ¿cómo valora la vicepresidenta que no se facilite al Tribunal de Cuentas la documentación que se le requiere sobre la condonación de la deuda de determinado partido político? Muchas gracias, señor presidente. (Aplausos.)\nRAMÓN AGUIRRE RODRÍGUEZ:  Señora vicepresidenta, yo no conozco ese dato, pero usted sí debería conocer un dato: ayer, en sede parlamentaria, cuando el gobernador del Banco de España fue requerido por este diputado para esta cuestión contestó que el Banco de España entregaría ese documento si el Partido Socialista, que es el titular de la deuda, lo autoriza. Por eso, le pido que ejerza de vicepresidenta y dé la orden al Partido Socialista (Rumores.) de que entregue ese acuerdo de condonación de deuda, porque si no, no solo estaremos tapando que se ha producido una condonación de deuda, que se ha producido un acto contra ley, sino que como dice el gobernador del Banco de España ustedes han tenido una subvención que les favorece sobre el resto de los partidos. Algo deben estar ustedes ocultando en ese acuerdo (Rumores.), y no es solo el regalo que significa financieramente, sino que estoy convencido de que si conocemos ese acuerdo nos enteraremos a cambio de qué han obtenido ese regalo. Muchísimas gracias. (Una señora diputada: ¡Muy bien!-Aplausos.)",
"\nLUISA FERNANDA RUDI ÚBEDA: QUÉ MEDIDAS PIENSA ADOPTAR EL GOBIERNO PARA QUE VUELVAN A TENER ACCESO AL CRÉDITO LAS FAMILIAS Y LAS EMPRESAS ESPAÑOLAS",
"\nLUISA FERNANDA RUDI UBEDA:  Muchas gracias, señor presidente. Señora vicepresidenta, según los últimos datos publicados por el Banco de España, el acceso al crédito de las empresas lleva seis meses cayendo y ha alcanzado un interanual del 2,5 por ciento, frente a esa misma cifra que el año anterior había sido positiva hasta el 6,6 por ciento. El crédito de las familias, aunque ha crecido hasta un 0,2, también está en una cifra sensiblemente inferior a la del año pasado. Sin embargo, señora vicepresidenta, en abril de este año el crédito a las administraciones públicas ha llegado hasta un 20,3 por ciento. Señora vicepresidenta, ¿cómo valora estos datos y qué medidas piensa tomar el Gobierno para facilitar el acceso al crédito de las empresas y las familias?\nLUISA FERNANDA RUDI UBEDA:  Muchas gracias, señor presidente. Señora vicepresidenta, entre la situación del crédito hace dos años y la actual hay un término medio, y estoy segura de que usted coincidirá conmigo en que es en ese término medio donde teníamos que estar. Pero, fíjese, señora vicepresidenta, si pregunta a las asociaciones de autónomos y de pequeñas y medianas empresas comprobará, como le podrán decir, que las líneas del ICO no han funcionado. Usted me dice que hay cinco mil peticiones. Dentro de unos meses le preguntaré cuántas de esas peticiones han sido concedidas, porque ese es el problema, las empresas acuden a pedir, pero no tienen acceso al crédito. Señora vicepresidenta, sabe tan bien como yo que las tensiones en el mercado interbancario están agravadas en España por la falta de confianza en nuestra economía. Eso dificulta la situación financiera de liquidez de nuestras entidades financieras, y eso supone que, a su vez, no faciliten el crédito a las empresas y a las familias y, por tanto, dificulta la recuperación económica. Señora vicepresidenta, su política económica nos ha introducido en un círculo vicioso diabólico que no hay forma de romper porque, al mismo tiempo que el crédito no llega a las empresas y a las familias, resulta que el crédito que está dando el Banco Central Europeo a las entidades financieras españolas están yendo en una parte importante a financiar la deuda pública española. Sabe tan bien como yo que en el primer trimestre del año 2010, según los informes internacionales, España ha sido el principal país emisor de deuda pública. Señora vicepresidenta, llevamos año y medio reclamándoles una reforma del sistema financiero, llevamos mucho tiempo diciéndoles que tomen medidas que permitan reactivar la economía. Tienen el apoyo del Partido Popular, como acaba de recordar, pero, señora vicepresidenta, desde el 4 de mayo que el señor Rajoy le aceptó la propuesta al señor presidente del Gobierno, ¿qué pasa que no mandan ustedes el proyecto de ley de reforma del sector financiero? Señora vicepresidenta, el tiempo corre, y corre en contra de nuestras empresas y de nuestras familias. (Aplausos.)",
"\nJUAN JOSÉ MATARÍ SÁEZ: SE PLANTEA EL GOBIERNO LA DISOLUCIÓN DEL AYUNTAMIENTO DE EL EJIDO\nJUAN JOSÉ MATARÍ SÁEZ:  Gracias, señor presidente. La Ley de Régimen Local prevé que el Consejo de Ministros puede disolver los órganos de gobierno de las corporaciones locales, en el supuesto de gestión gravemente dañosa para los intereses generales que supongan incumplimiento de obligaciones constitucionales. La gestión del actual equipo de gobierno del Ayuntamiento de El Ejido, se ha realizado de espaldas a la ley y en contra de esos intereses generales. Eso ha tenido como consecuencia la intervención judicial en la que fueron detenidos el alcalde, el interventor municipal y otras veinte personas. Señor vicepresidente, una vez que usted se ha ocupado de autoconfirmarse como ministro, le pregunto si se plantea el Gobierno la disolución de los órganos de gobierno del Ayuntamiento de El Ejido.\nJUAN JOSÉ MATARÍ SÁEZ:  Señor Matarí, señor Chaves, no señor Tamariz. (Risas.) No me diga que no se dan las causas legales. Lo mismo dijo en el caso de Estepona y hoy el alcalde socialista está imputado. La mayoría de las causas recogidas en el real decreto del Ministerio de Administraciones Públicas para disolver el Ayuntamiento de Marbella se dan en este caso, en el caso de El Ejido. Las mismas causas, señor Chaves. Léase el decreto y compruébelo. Ustedes han tomado una decisión política por causas partidistas. ¿No cree usted comprometido el interés general cuando en la gestión del Ayuntamiento de El Ejido se dan, según el acto judicial, los presuntos delitos de cohecho, prevaricación, falsedad documental, blanqueo de capitales y tráfico de influencias? ¿No cree usted que está afectado el interés general cuando puede haberse producido un perjuicio para el erario público de 300 millones de euros, y cuando no existen garantías -y esta es la clave, señor Chaves- de que no se sigan produciendo perjuicios en estos momentos, sino más bien todo lo contrario? ¿No cree usted que se están incumpliendo obligaciones constitucionales, artículo 103 de la Constitución? ¿No cree usted que todo esto -ocho meses ha estado el alcalde en prisión- supone un escándalo político sin precedentes, que genera una alarma social y provoca desconfianza entre los ciudadanos hacia las instituciones democráticas? Me dirá ahora que fue alcalde del Partido Popular, pero, señor Chaves, cuando se empezaron a conocer las irregularidades en el año 2005 el Partido Popular lo echó, y usted pactó con el señor Enciso para conseguir poder político sin ganar elecciones. El resultado ha sido el desprestigio de la Diputación de Almería, la intervención judicial del Ayuntamiento de El Ejido, y la situación actual de su partido en la provincia de Almería. Usted va a ser también ahora el responsable de que el Ayuntamiento de El Ejido siga presidido por alguien que está en libertad bajo fianza, acusado de gravísimos delitos de corrupción que perjudican gravemente la gestión pública, los servicios públicos y los intereses generales. Esto es una anomalía democrática, señor Chaves, y en sus manos está corregirla. Solo tiene que pensar en los intereses generales y no en los intereses de su partido. (Varios señores diputados: ¡Muy bien!-Aplausos.)"]}].map(party);

data.speakers = {"MARÍA SORAYA SÁENZ DE SANTAMARÍA ANTÓN": {name: "MARÍA SORAYA SÁENZ DE SANTAMARÍA ANTÓN", title: "Popular (PP)"}, "MARÍA SORAYA SÁENZ DE SANTAMARÍA ANTÓN": {name: "María Soraya Sáenz de Santamaría Antón", title: "Popular (PP)"}, "MARÍA TERESA FERNÁNDEZ DE LA VEGA SANZ": {name: "María Teresa Fernández de la Vega Sanz", title: "Socialista (PSOE)"}, "RAMÓN AGUIRRE RODRÍGUEZ": {name: "RAMÓN AGUIRRE RODRÍGUEZ", title: "Popular (PP)"}, "RAMÓN AGUIRRE RODRÍGUEZ": {name: "Ramón Aguirre Rodríguez", title: "Popular (PP)"}, "ELENA SALGADO MÉNDEZ": {name: "Elena Salgado Méndez", title: "Socialista (PSOE)"}, "LUISA FERNANDA RUDI ÚBEDA": {name: "LUISA FERNANDA RUDI ÚBEDA", title: "Popular (PP)"}, "LUISA FERNANDA RUDI UBEDA": {name: "Luisa Fernanda Rudi Ubeda", title: "Popular (PP)"}, "MANUEL MARÍA CHAVES GONZÁLEZ": {name: "Manuel María Chaves González", title: "Socialista (PSOE)"}, "JUAN JOSÉ MATARÍ SÁEZ": {name: "JUAN JOSÉ MATARÍ SÁEZ", title: "Popular (PP)"}, "JUAN JOSÉ MATARÍ SÁEZ": {name: "Juan José Matarí Sáez", title: "Popular (PP)"}};

data.topics = [{name: "barcelona", re: /\b(barcelona)\b/gi, x: 62.0, y: 62.0}, {name: "social", re: /\b(social)\b/gi, x: 118.0, y: 52.0}, {name: "fomento", re: /\b(fomento)\b/gi, x: 174.0, y: 52.0}, {name: "economía", re: /\b(economía)\b/gi, x: 224.0, y: 46.0}, {name: "seguridad", re: /\b(seguridad)\b/gi, x: 270.0, y: 42.0}, {name: "renovables", re: /\b(renovables)\b/gi, x: 314.0, y: 40.0}, {name: "ave", re: /\b(ave)\b/gi, x: 356.0, y: 38.0}, {name: "conexión", re: /\b(conexión)\b/gi, x: 398.0, y: 38.0}, {name: "alta velocidad", re: /\b(alta velocidad)\b/gi, x: 438.0, y: 36.0}, {name: "transporte", re: /\b(transporte)\b/gi, x: 476.0, y: 34.0}, {name: "familias", re: /\b(familias)\b/gi, x: 512.0, y: 32.0}, {name: "energético", re: /\b(energético)\b/gi, x: 548.0, y: 32.0}, {name: "vasco", re: /\b(vasco)\b/gi, x: 582.0, y: 30.0}, {name: "energías renovables", re: /\b(energías renovables)\b/gi, x: 610.0, y: 24.0}, {name: "reforma laboral", re: /\b(reforma laboral)\b/gi, x: 638.0, y: 24.0}].map(topic);

data.topic = function(name) {
  var t = topic({name: name, re: new RegExp("\\b(" + d3.requote(name) + ")\\b", "gi")}, data.topics.length);
  data.topics.push(t);
  return t;
};

function party(party) {
  party.speeches = party.speeches.map(speech);
  party.sections = sections(party.speeches);
  party.wordCount = d3.sum(party.sections, function(d) { return countWords(d.speech.text.substring(d.i, d.j)); });
  return party;
}

function speech(text, i) {
  return {text: text, id: i};
}

function sections(speeches) {
  // PFS: Afegeixo alguns caracters accentuats que no pertanyen a l'alfabet anglès
  // var speakerRe = /(?:\n|^)([A-Z\.()\- ]+): /g,
  var speakerRe = /(?:\n|^)([A-ZÁÉÍÓÚÑÀÈÇ\.()\- ]+): /g,
      sections = [];

  speeches.forEach(function(speech) {
    var speakerName = "AUDIENCE",
        match,
        i = speakerRe.lastIndex = 0;
    while (match = speakerRe.exec(speech.text)) {
      if (match.index > i) sections.push({speaker: speakerName, speech: speech, i: i, j: match.index});
      speakerName = match[1];
      i = speakerRe.lastIndex;
    }
    sections.push({speaker: speakerName, speech: speech, i: i, j: speech.text.length});
  });

  return sections.filter(function(d) { return !/^AUDIENCE\b/.test(d.speaker); });
}

function topic(topic, i) {
  topic.id = i;
  topic.count = 0;
  topic.cx = topic.x;
  topic.cy = topic.y;

  topic.parties = data.parties.map(function(party) {
    var count = 0,
        mentions = [];

    party.sections.forEach(function(section) {
      var text = section.speech.text.substring(section.i, section.j), match;
      topic.re.lastIndex = 0;
      while (match = topic.re.exec(text)) {
        ++count;
        mentions.push({
          topic: topic,
          section: section,
          i: section.i + match.index,
          j: section.i + topic.re.lastIndex
        });
      }
    });

    topic.count += count = count / party.wordCount * 25e3;
    return {count: count, mentions: mentions};
  });

  return topic;
}

function countWords(text) {
  return text.split(/\s+/g)
      .filter(function(d) { return d !== "—"; })
      .length;
}

})();

(function() {

var width = 970,
    height = 540;

var collisionPadding = 4,
    clipPadding = 4,
    minRadius = 16, // minimum collision radius
    maxRadius = 65, // also determines collision search radius
    maxMentions = 100, // don't show full transcripts
    activeTopic; // currently-displayed topic

var formatShortCount = d3.format(",.0f"),
    formatLongCount = d3.format(".1f"),
    formatCount = function(d) { return (d < 10 ? formatLongCount : formatShortCount)(d); };

var r = d3.scale.sqrt()
    .domain([0, d3.max(data.topics, function(d) { return d.count; })])
    .range([0, maxRadius]);

var force = d3.layout.force()
    .charge(0)
    .size([width, height - 80])
    .on("tick", tick);

var node = d3.select(".g-nodes").selectAll(".g-node"),
    label = d3.select(".g-labels").selectAll(".g-label"),
    arrow = d3.select(".g-nodes").selectAll(".g-note-arrow");

d3.select(".g-nodes").append("rect")
    .attr("class", "g-overlay")
    .attr("width", width)
    .attr("height", height)
    .on("click", clear);

d3.select(window)
    .on("hashchange", hashchange);

d3.select("#g-form")
    .on("submit", submit);

updateTopics(data.topics);
hashchange();

// Update the known topics.
function updateTopics(topics) {
  topics.forEach(function(d) {
    d.r = r(d.count);
    d.cr = Math.max(minRadius, d.r);
    d.k = fraction(d.parties[0].count, d.parties[1].count);
    if (isNaN(d.k)) d.k = .5;
    if (isNaN(d.x)) d.x = (1 - d.k) * width + Math.random();
    d.bias = .5 - Math.max(.1, Math.min(.9, d.k));
  });
  force.nodes(data.topics = topics).start();
  updateNodes();
  updateLabels();
  updateArrows();
  tick({alpha: 0}); // synchronous update
}

// Update the displayed nodes.
function updateNodes() {
  node = node.data(data.topics, function(d) { return d.name; });

  node.exit().remove();

  var nodeEnter = node.enter().append("a")
      .attr("class", "g-node")
      .attr("xlink:href", function(d) { return "#" + encodeURIComponent(d.name); })
      .call(force.drag)
      .call(linkTopic);

  var democratEnter = nodeEnter.append("g")
      .attr("class", "g-democrat");

  democratEnter.append("clipPath")
      .attr("id", function(d) { return "g-clip-democrat-" + d.id; })
    .append("rect");

  democratEnter.append("circle");

  var republicanEnter = nodeEnter.append("g")
      .attr("class", "g-republican");

  republicanEnter.append("clipPath")
      .attr("id", function(d) { return "g-clip-republican-" + d.id; })
    .append("rect");

  republicanEnter.append("circle");

  nodeEnter.append("line")
      .attr("class", "g-split");

  node.selectAll("rect")
      .attr("y", function(d) { return -d.r - clipPadding; })
      .attr("height", function(d) { return 2 * d.r + 2 * clipPadding; });

  node.select(".g-democrat rect")
      .style("display", function(d) { return d.k > 0 ? null : "none" })
      .attr("x", function(d) { return -d.r - clipPadding; })
      .attr("width", function(d) { return 2 * d.r * d.k + clipPadding; });

  node.select(".g-republican rect")
      .style("display", function(d) { return d.k < 1 ? null : "none" })
      .attr("x", function(d) { return -d.r + 2 * d.r * d.k; })
      .attr("width", function(d) { return 2 * d.r; });

  node.select(".g-democrat circle")
      .attr("clip-path", function(d) { return d.k < 1 ? "url(#g-clip-democrat-" + d.id + ")" : null; });

  node.select(".g-republican circle")
      .attr("clip-path", function(d) { return d.k > 0 ? "url(#g-clip-republican-" + d.id + ")" : null; });

  node.select(".g-split")
      .attr("x1", function(d) { return -d.r + 2 * d.r * d.k; })
      .attr("y1", function(d) { return -Math.sqrt(d.r * d.r - Math.pow(-d.r + 2 * d.r * d.k, 2)); })
      .attr("x2", function(d) { return -d.r + 2 * d.r * d.k; })
      .attr("y2", function(d) { return Math.sqrt(d.r * d.r - Math.pow(-d.r + 2 * d.r * d.k, 2)); });

  node.selectAll("circle")
      .attr("r", function(d) { return r(d.count); });
}

// Update the displayed node labels.
function updateLabels() {
  label = label.data(data.topics, function(d) { return d.name; });

  label.exit().remove();

  var labelEnter = label.enter().append("a")
      .attr("class", "g-label")
      .attr("href", function(d) { return "#" + encodeURIComponent(d.name); })
      .call(force.drag)
      .call(linkTopic);

  labelEnter.append("div")
      .attr("class", "g-name")
      .text(function(d) { return d.name; });

  labelEnter.append("div")
      .attr("class", "g-value");

  label
      .style("font-size", function(d) { return Math.max(8, d.r / 2) + "px"; })
      .style("width", function(d) { return d.r * 2.5 + "px"; });

  // Create a temporary span to compute the true text width.
  label.append("span")
      .text(function(d) { return d.name; })
      .each(function(d) { d.dx = Math.max(d.r * 2.5, this.getBoundingClientRect().width); })
      .remove();

  label
      .style("width", function(d) { return d.dx + "px"; })
    .select(".g-value")
      .text(function(d) { return formatShortCount(d.parties[0].count) + " - " + formatShortCount(d.parties[1].count); });

  // Compute the height of labels when wrapped.
  label.each(function(d) { d.dy = this.getBoundingClientRect().height; });
}

// Update the active topic.
function updateActiveTopic(topic) {
  d3.selectAll(".g-head").attr("class", topic ? "g-head g-has-topic" : "g-head g-hasnt-topic");
  if (activeTopic = topic) {
    node.classed("g-selected", function(d) { return d === topic; });
    updateMentions(findMentions(topic));
    d3.selectAll(".g-head a").text(topic.name);
    d3.select(".g-democrat .g-head span.g-count").text(formatCount(topic.parties[0].count));
    d3.select(".g-republican .g-head span.g-count").text(formatCount(topic.parties[1].count));
  } else {
    node.classed("g-selected", false);
    updateMentions(sampleMentions());
    d3.selectAll(".g-head a").text("various topics");
    d3.selectAll(".g-head span.g-count").text("some number of");
  }
}

// Update displayed excerpts.
function updateMentions(mentions) {
  var column = d3.selectAll(".g-mentions")
      .data(mentions);

  column.select(".g-truncated")
      .style("display", function(d) { return d.truncated ? "block" : null; });

  var mention = column.selectAll(".g-mention")
      .data(groupMentionsBySpeaker, function(d) { return d.key; });

  mention.exit().remove();

  mention.selectAll("p")
      .remove();

  var mentionEnter = mention.enter().insert("div", ".g-truncated")
      .attr("class", "g-mention");

  mentionEnter.append("div")
      .attr("class", "g-speaker")
      .text(function(d) { var s = data.speakers[d.key]; return s ? s.name : d.key; });

  mentionEnter.append("div")
      .attr("class", "g-speaker-title")
      .text(function(d) { var s = data.speakers[d.key]; return s && s.title; });

  mention
      .sort(function(a, b) { return b.values.length - a.values.length; });

  var p = mention.selectAll("p")
      .data(function(d) { return d.values; })
    .enter().append("p")
      .html(function(d) { return d.section.speech.text.substring(d.start, d.end).replace(d.topic.re, "<a>$1</a>"); });

  if (activeTopic) {
    p.attr("class", "g-hover");
  } else {
    p.each(function(d) {
      d3.select(this).selectAll("a")
          .datum(d.topic)
          .attr("href", "#" + encodeURIComponent(d.topic.name))
          .call(linkTopic);
    });
  }
}

// Bind the arrow path elements with their associated topic.
function updateArrows() {
  arrow = arrow.data(
      data.topics.filter(function(d) { return d.arrow; }),
      function(d) { return this.id ? this.id.substring(8) : d.arrow; });
}

// Return a random sample of mentions per party, one per topic.
// Mentions are returned in chronological order.
function sampleMentions() {
  return data.parties.map(function(party, i) {
    return data.topics
        .map(function(d) { return d.parties[i].mentions; })
        .filter(function(d) { return d.length; })
        .map(function(d) { return d[Math.floor(Math.random() * d.length)]; })
        .sort(orderMentions);
  });
}

// Return displayable mentions per party for the specified topic.
// If too many, a random sample of matching mentions is returned.
// Mentions are returned in chronological order.
function findMentions(topic) {
  return data.parties.map(function(party, i) {
    var mentions = topic.parties[i].mentions;
    if (mentions.length > maxMentions) {
      shuffle(mentions).length = maxMentions;
      mentions.sort(orderMentions);
      mentions.truncated = true;
    }
    return mentions;
  });
}

// Group mentions by speaker, collapse overlapping excerpts.
function groupMentionsBySpeaker(mentions) {
  return d3.nest()
      .key(function(d) { return d.section.speaker; })
      .rollup(collapseMentions)
      .entries(mentions);
}

// Given an array of mentions, computes the start and end point of the context
// excerpt, and then collapses any overlapping excerpts.
function collapseMentions(mentions) {
  var sentenceRe = /([!?.)]+)\s+/g, // sentence splitting requires NLP
      i,
      n = mentions.length,
      d0,
      d1;

  // First compute the excerpt contexts.
  for (i = 0; i < n; ++i) {
    d0 = mentions[i];
    d0.start = excerptStart(d0);
    d0.end = excerptEnd(d0);
  }

  // Then collapse any overlapping excerpts (from the same speech).
  for (i = 1, d1 = mentions[0]; i < n; ++i) {
    d0 = d1;
    d1 = mentions[i];
    if (d1.section.speech.id === d0.section.speech.id
        && d1.start >= d0.start
        && d1.start < d0.end) {
      d1.start = -1;
      d0.end = d1.end;
      d1 = d0;
    }
  }

  // Returns the start index of the excerpt for the specified mention.
  function excerptStart(mention) {
    var i = sentenceRe.lastIndex = Math.max(mention.section.i, mention.i - 80), match;
    while (match = sentenceRe.exec(mention.section.speech.text)) {
      if (match.index < mention.i - 20) return match.index + match[0].length;
      if (i <= mention.section.i) break;
      sentenceRe.lastIndex = i = Math.max(mention.section.i, i - 20);
    }
    return mention.section.i;
  }

  // Returns the end index of the excerpt for the specified mention.
  function excerptEnd(mention) {
    var i = mention.section.j, match;
    sentenceRe.lastIndex = mention.j + 40;
    match = sentenceRe.exec(mention.section.speech.text);
    return match ? Math.min(match.index + match[1].length, i) : i;
  }

  return mentions.filter(function(d) { return d.start >= 0; });
}

// Orders mentions chronologically: by speech and position within speech.
function orderMentions(a, b) {
  return a.section.speech.id - b.section.speech.id || a.i - b.i;
}

// Assign event handlers to topic links.
function linkTopic(a) {
  a   .on("click", click)
      .on("mouseover", mouseover)
      .on("mouseout", mouseout);
}

// Returns the topic matching the specified name, approximately.
// If no matching topic is found, returns undefined.
function findTopic(name) {
  for (var i = 0, n = data.topics.length, t; i < n; ++i) {
    if ((t = data.topics[i]).name === name || new RegExp("^" + (t = data.topics[i]).re.source + "$", "i").test(name)) {
      return t;
    }
  }
}

// Returns the topic matching the specified name, approximately.
// If no matching topic is found, a new one is created.
function findOrAddTopic(name) {
  var topic = findTopic(name);
  if (!topic) {
    topic = data.topic(name.substring(0, 1).toUpperCase() + name.substring(1));
    topic.y = 0;
    updateTopics(data.topics);
  }
  return topic;
}

// Simulate forces and update node and label positions on tick.
function tick(e) {
  node
      .each(bias(e.alpha * 105))
      .each(collide(.5))
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

  label
      .style("left", function(d) { return (d.x - d.dx / 2) + "px"; })
      .style("top", function(d) { return (d.y - d.dy / 2) + "px"; });

  arrow.style("stroke-opacity", function(d) {
    var dx = d.x - d.cx, dy = d.y - d.cy;
    return dx * dx + dy * dy < d.r * d.r ? 1: 0;
  });
}

// A left-right bias causing topics to orient by party preference.
function bias(alpha) {
  return function(d) {
    d.x += d.bias * alpha;
  };
}

function rotate() {
	return function(d) {
	var c = Math.cos(Math.PI/8.);
	var s = Math.sin(Math.PI/8.);
	
	d.x -= width/2.;
	d.y -= height/2.
	
	var n_x = d.x*c - d.y*s;
	var n_y = d.x*s + d.y*c;
	
	d.x = n_x + width/2.;
	d.y = n_y + height/2.;
	};
}

// Resolve collisions between nodes.
function collide(alpha) {
  var q = d3.geom.quadtree(data.topics);
  return function(d) {
    var r = d.cr + maxRadius + collisionPadding,
        nx1 = d.x - r,
        nx2 = d.x + r,
        ny1 = d.y - r,
        ny2 = d.y + r;
    q.visit(function(quad, x1, y1, x2, y2) {
      if (quad.point && (quad.point !== d) && d.other !== quad.point && d !== quad.point.other) {
        var x = d.x - quad.point.x,
            y = d.y - quad.point.y,
            l = Math.sqrt(x * x + y * y),
            r = d.cr + quad.point.r + collisionPadding;
        if (l < r) {
          l = (l - r) / l * alpha;
          d.x -= x *= l;
          d.y -= y *= l;
          quad.point.x += x;
          quad.point.y += y;
        }
      }
      return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
    });
  };
}

// Fisher–Yates shuffle.
function shuffle(array) {
  var m = array.length, t, i;
  while (m) {
    i = Math.floor(Math.random() * m--);
    t = array[m];
    array[m] = array[i];
    array[i] = t;
  }
  return array;
}

// Given two quantities a and b, returns the fraction to split the circle a + b.
function fraction(a, b) {
  var k = a / (a + b);
  if (k > 0 && k < 1) {
    var t0, t1 = Math.pow(12 * k * Math.PI, 1 / 3);
    for (var i = 0; i < 10; ++i) { // Solve for theta numerically.
      t0 = t1;
      t1 = (Math.sin(t0) - t0 * Math.cos(t0) + 2 * k * Math.PI) / (1 - Math.cos(t0));
    }
    k = (1 - Math.cos(t1 / 2)) / 2;
  }
  return k;
}

// Update the active topic on hashchange, perhaps creating a new topic.
function hashchange() {
  var name = decodeURIComponent(location.hash.substring(1)).trim();
  updateActiveTopic(name && name != "!" ? findOrAddTopic(name) : null);
}

// Trigger a hashchange on submit.
function submit() {
  var name = this.search.value.trim();
  location.hash = name ? encodeURIComponent(name) : "!";
  this.search.value = "";
  d3.event.preventDefault();
}

// Clear the active topic when clicking on the chart background.
function clear() {
  location.replace("#!");
}

// Rather than flood the browser history, use location.replace.
function click(d) {
  location.replace("#" + encodeURIComponent(d === activeTopic ? "!" : d.name));
  // PFS: 12/05/2015
  parent.resizeIframeByHeight(parent.document.getElementsByName('iframe_a')[0],document.getElementById('interactiveABC').scrollHeight);
  d3.event.preventDefault();
}

// When hovering the label, highlight the associated node and vice versa.
// When no topic is active, also cross-highlight with any mentions in excerpts.
function mouseover(d) {
  node.classed("g-hover", function(p) { return p === d; });
  if (!activeTopic) d3.selectAll(".g-mention p").classed("g-hover", function(p) { return p.topic === d; });
}

// When hovering the label, highlight the associated node and vice versa.
// When no topic is active, also cross-highlight with any mentions in excerpts.
function mouseout(d) {
  node.classed("g-hover", false);
  if (!activeTopic) d3.selectAll(".g-mention p").classed("g-hover", false);
}

})();
